# 🧪 Testing Guide

## מדריך בדיקות לפרויקט Walkie-Talkie

---

## 📋 רשימת בדיקות

### 1. בדיקות RF (תקשורת אלחוטית)

#### 1.1 בדיקת זמינות מודול LoRa

```bash
# בדקו את הלוגים בהפעלה
pio device monitor
```

**צפוי להופיע:**
```
[RADIO] Initializing LoRa radio...
[RADIO] Radio version: 0x12
[RADIO] LoRa radio initialized successfully
```

**שגיאות אפשריות:**
- `Invalid radio version` - בעיית חיבור SPI
- `Failed to initialize` - בדקו את חיבורי ה-pins

#### 1.2 בדיקת שידור (TX)

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| לחיצת PTT | הודעת `TX started` בלוג | ☐ |
| שחרור PTT | הודעת `TX done` בלוג | ☐ |
| LED שידור | נדלק בזמן שידור | ☐ |

#### 1.3 בדיקת קליטה (RX)

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| חבילה נכנסת | הודעת `RX done` בלוג | ☐ |
| RSSI תקין | ערך בין -120 ל-0 dBm | ☐ |
| SNR תקין | ערך בין -20 ל+10 dB | ☐ |

#### 1.4 בדיקת טווח

| מרחק | קו ראייה | מכשולים | RSSI צפוי |
|------|----------|---------|-----------|
| 10 מ' | ✓ | - | -40 dBm |
| 100 מ' | ✓ | - | -70 dBm |
| 500 מ' | ✓ | - | -90 dBm |
| 1 ק"מ | ✓ | - | -100 dBm |
| 5 ק"מ | ✓ | - | -110 dBm |

---

### 2. בדיקות אודיו

#### 2.1 מיקרופון

```c
// בדיקת רמות ADC
// צפי: ללא קלט ~2048 (מרכז), עם קלט תנודות
```

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| רמת רקע | יציב סביב 2048 | ☐ |
| קלט דיבור | תנודות 1500-2500 | ☐ |
| קלט חזק | תנודות 500-3500 | ☐ |
| AGC עובד | אין clipping | ☐ |

#### 2.2 רמקול/DAC

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| ביפ אתחול | נשמע בהפעלה | ☐ |
| ווליום מינימום | שמיעה חלשה | ☐ |
| ווליום מקסימום | שמיעה חזקה, ללא עיוות | ☐ |
| השתקה | שקט מוחלט | ☐ |

#### 2.3 בדיקת איכות שיחה

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| דיבור רציף | ללא קטיעות | ☐ |
| latency | פחות מ-200ms | ☐ |
| בהירות | מובן | ☐ |

---

### 3. בדיקות סוללה

#### 3.1 מדידת מתח

| מצב סוללה | מתח | ADC ערך (משוער) |
|------------|-----|-----------------|
| מלאה | 4.2V | 2100 |
| 75% | 3.9V | 1950 |
| 50% | 3.7V | 1850 |
| 25% | 3.5V | 1750 |
| ריקה | 3.0V | 1500 |

#### 3.2 בדיקת טעינה

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| חיבור USB | LED טעינה נדלק | ☐ |
| סיום טעינה | LED כבה/משתנה צבע | ☐ |
| מתח מלא | 4.2V | ☐ |

#### 3.3 צריכת אנרגיה

| מצב | צריכה צפויה |
|-----|-------------|
| המתנה | ~10 mA |
| קליטה | ~25 mA |
| שידור | ~120 mA |
| שינה | ~1 mA |

---

### 4. בדיקות UI (מסך + כפתורים)

#### 4.1 מסך OLED

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| הפעלה | מסך נדלק | ☐ |
| שורת סטטוס | סוללה + קליטה | ☐ |
| ניווט | מעבר בין מסכים | ☐ |
| עברית | תווים מוצגים נכון* | ☐ |

*הערה: תמיכה בעברית דורשת גופן מיוחד

#### 4.2 כפתורים

| כפתור | פעולה קצרה | פעולה ארוכה | תוצאה |
|--------|------------|-------------|--------|
| ירוק | אישור/התקשר | - | ☐ |
| אדום | ביטול/נתק | כיבוי | ☐ |
| מעל ירוק | פונקציה 1 | - | ☐ |
| מעל אדום | פונקציה 2 | - | ☐ |
| PTT | שידור (באמצע) | - | ☐ |
| הקלטה | התחל/עצור | - | ☐ |

#### 4.3 מתג PTT

| מצב | התנהגות | תוצאה |
|-----|----------|--------|
| למעלה | תמיד משדר | ☐ |
| אמצע | PTT רגיל | ☐ |
| למטה | מושתק | ☐ |

#### 4.4 גלגלות

| גלגלת | פעולה | תוצאה |
|-------|--------|--------|
| ווליום | שינוי עוצמה | ☐ |
| מצבים | מעבר 1-15 | ☐ |

---

### 5. בדיקות אחסון

#### 5.1 SPIFFS

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| טעינה | `SPIFFS mounted` | ☐ |
| כתיבה | ללא שגיאות | ☐ |
| קריאה | נתונים תקינים | ☐ |

#### 5.2 כרטיס SD

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| זיהוי | `SD card mounted` | ☐ |
| שמירת הקלטה | קובץ WAV נוצר | ☐ |
| קריאה | הקלטה מושמעת | ☐ |

---

### 6. בדיקות USB

#### 6.1 CDC Serial

```bash
# התחברות
pio device monitor
# או
screen /dev/ttyUSB0 115200
```

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| חיבור | פורט מזוהה | ☐ |
| פקודת INFO | תגובת JSON | ☐ |
| פקודת STATUS | סטטוס נוכחי | ☐ |

#### 6.2 Mass Storage (ESP32-S3)

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| חיבור | דיסק מופיע | ☐ |
| גישה לקבצים | הקלטות נראות | ☐ |
| העתקה | קבצים מועתקים | ☐ |

---

### 7. בדיקות פרוטוקול

#### 7.1 גילוי מכשירים

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| שליחת DISCOVER | חבילה יוצאת | ☐ |
| קבלת תגובה | מכשיר מופיע ברשימה | ☐ |

#### 7.2 התקשרות

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| שליחת בקשה | CALL_REQUEST נשלח | ☐ |
| קבלת אישור | CALL_ACCEPT מתקבל | ☐ |
| מעבר לשיחה | STATE_IN_CALL | ☐ |

#### 7.3 תדרים

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| יצירת תדר | FREQ_CREATE | ☐ |
| הצטרפות | FREQ_JOIN | ☐ |
| שיחה קבוצתית | אודיו לכולם | ☐ |

---

### 8. בדיקות אבטחה

#### 8.1 מזהה מכשיר

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| יצירת ID | 8 ספרות ייחודיות | ☐ |
| עקביות | אותו ID אחרי restart | ☐ |

#### 8.2 הצפנה

| בדיקה | צפי | תוצאה |
|-------|-----|--------|
| החלפת מפתחות | ECDH מצליח | ☐ |
| הצפנת אודיו | AES-GCM | ☐ |
| אימות | HMAC תקין | ☐ |

---

## 🛠️ כלי בדיקה

### SDR (Software Defined Radio)

לבדיקת שידורי RF:
- RTL-SDR dongle
- GQRX או SDR#
- צפו בתדר 433/868/915 MHz

### לוגים

```bash
# לוגים מפורטים
pio device monitor --filter esp32_exception_decoder

# שמירה לקובץ
pio device monitor > log.txt
```

### Oscilloscope

לבדיקת אותות:
- אודיו: GPIO 25 (DAC)
- SPI: GPIO 18, 19, 23

---

## 📊 טופס תוצאות בדיקה

```
תאריך: _______________
גרסה: _______________
בודק: _______________

סיכום:
- RF:      [ ] עבר  [ ] נכשל
- אודיו:   [ ] עבר  [ ] נכשל
- סוללה:   [ ] עבר  [ ] נכשל
- UI:      [ ] עבר  [ ] נכשל
- אחסון:   [ ] עבר  [ ] נכשל
- USB:     [ ] עבר  [ ] נכשל
- פרוטוקול:[ ] עבר  [ ] נכשל
- אבטחה:   [ ] עבר  [ ] נכשל

הערות:
___________________________________
___________________________________
___________________________________

חתימה: _______________
```

---

## 🐛 דיווח באגים

בעת מציאת באג, כללו:

1. **תיאור**: מה קרה
2. **צעדים**: איך לשחזר
3. **צפי**: מה היה צריך לקרות
4. **לוגים**: פלט מהמסוף
5. **סביבה**: גרסת firmware, חומרה

---

<div align="center">

**🧪 Happy Testing! 🔧**

</div>

